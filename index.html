<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interactive MCQ Quiz</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    
    // Pull React hooks from the global 'React' object
    const { useEffect, useMemo, useRef, useState } = React;

    // Single‚Äëfile interactive quiz app

    function App() {
      // RAW Data Block (Cleaned Version)
      const RAW = `1. What is the primary function of photosynthesis?
o a) Convert oxygen to carbon dioxide
o b) Convert solar energy into chemical energy
o c) Break down glucose
o d) Generate heat

2. Which organelle is responsible for photosynthesis?
o a) Mitochondria
o b) Ribosome
o c) Chloroplast
o d) Nucleus

3. Autotrophs differ from heterotrophs because they:
o a) Depend on others for food
o b) Use sunlight to produce food
o c) Consume dead matter
o d) Do not require energy

4. The ultimate source of energy for photosynthesis is:
o a) Water
o b) Glucose
o c) Sunlight
o d) ATP

5. The gas released during photosynthesis is:
o a) Carbon dioxide
o b) Oxygen
o c) Nitrogen
o d) Methane

6. What is the main pigment in photosynthesis?
o a) Chlorophyll
o b) Hemoglobin
o c) Carotenoids
o d) Melanin

7. What is the first step of the Calvin cycle?
o a) Reduction
o b) Carbon fixation
o c) Regeneration
o d) Glycolysis

8. ATP and NADPH are produced during:
o a) Light reactions
o b) Calvin cycle
o c) Glycolysis
o d) Fermentation

9. The electron transport chain is located in the:
o a) Cytoplasm
o b) Thylakoid membrane
o c) Nucleus
o d) Mitochondria

10. Which enzyme is crucial in the Calvin cycle?
o a) ATP synthase
o b) Rubisco
o c) DNA polymerase
o d) Amylase

11. Which reactant is split to release oxygen in photosynthesis?
o a) Carbon dioxide
o b) Water
o c) Glucose
o d) NADPH

12. Where do the light-dependent reactions take place?
o a) Stroma
o b) Cytoplasm
o c) Thylakoid membrane
o d) Nucleus

13. The Calvin cycle occurs in the:
o a) Cytoplasm
o b) Stroma
o c) Thylakoid membrane
o d) Mitochondria

14. Which of the following is not a product of the light reactions?
o a) ATP
o b) NADPH
o c) Oxygen
o d) Glucose

15. The function of NADPH in photosynthesis is to:
o a) Store oxygen
o b) Transport electrons
o c) Capture sunlight
o d) Break down ATP

16. Which photosystem comes first in the electron transport chain?
o a) Photosystem I
o b) Photosystem II
o c) Both at the same time
o d) Neither

17. The Calvin cycle is also known as:
o a) Light-dependent reactions
o b) Carbon fixation cycle
o c) Photorespiration
o d) Krebs cycle

18. What is the main purpose of the Calvin cycle?
o a) Produce ATP
o b) Generate oxygen
o c) Convert CO‚ÇÇ into glucose
o d) Absorb sunlight

19. The role of Rubisco is to:
o a) Capture sunlight
o b) Fix carbon dioxide into organic molecules
o c) Break down water
o d) Transport electrons

20. How many CO‚ÇÇ molecules are needed to produce one molecule of glucose?
o a) 2
o b) 4
o c) 6
o d) 8

21. ATP is synthesized in the chloroplast by:
o a) Glycolysis
o b) Chemiosmosis
o c) Oxidative phosphorylation
o d) Krebs cycle

22. The process by which ATP is produced using light energy is called:
o a) Photophosphorylation
o b) Glycolysis
o c) Fermentation
o d) Respiration

23. Which molecules provide energy for the Calvin cycle?
o a) ATP and NADPH
o b) Glucose and oxygen
o c) Carbon dioxide and water
o d) Rubisco and chlorophyll

24. What happens to electrons in Photosystem II?
o a) They are transferred to ATP
o b) They gain energy from sunlight
o c) They are used to split oxygen
o d) They convert NADP+ to NADPH

25. What is the role of the electron transport chain?
o a) Pump protons across the thylakoid membrane
o b) Capture oxygen
o c) Convert ATP to ADP
o d) Produce glucose

26. In cyclic electron flow, what is produced?
o a) NADPH only
o b) ATP only
o c) Oxygen only
o d) Both ATP and NADPH

27. What is the primary waste product of photosynthesis?
o a) Water
o b) Carbon dioxide
o c) Oxygen
o d) Glucose

28. What happens in photorespiration?
o a) Plants produce extra ATP
o b) Rubisco binds to oxygen instead of carbon dioxide
o c) More glucose is formed
o d) The process becomes more efficient

29. C4 plants reduce photorespiration by:
o a) Closing stomata at night
o b) Using an alternative enzyme to fix CO‚ÇÇ
o c) Breaking down water more efficiently
o d) Increasing oxygen intake

30. CAM plants are adapted to:
o a) Wet environments
o b) Dry environments
o c) Cold environments
o d) High-salinity environments

31. The primary advantage of C4 photosynthesis over C3 photosynthesis is:
o a) More oxygen production
o b) Reduction of photorespiration
o c) Higher water retention
o d) Faster glucose breakdown

32. CAM plants open their stomata:
o a) Only at night
o b) Only during the day
o c) Both day and night
o d) Never

33. Which enzyme is responsible for carbon fixation in C4 plants?
o a) Rubisco
o b) PEP carboxylase
o c) ATP synthase
o d) NADP+ reductase

34. What is the major difference between cyclic and linear electron flow?
o a) Cyclic flow does not produce NADPH
o b) Linear flow does not use photosystem I
o c) Cyclic flow does not require sunlight
o d) Linear flow does not produce ATP

35. The oxygen released in photosynthesis comes from:
o a) Carbon dioxide
o b) Glucose
o c) Water
o d) ATP

36. In what type of environment would you expect to find CAM plants?
o a) Tropical rainforest
o b) Arctic tundra
o c) Desert
o d) Grassland

37. Which molecule provides the reducing power in photosynthesis?
o a) ATP
o b) NADPH
o c) Glucose
o d) Oxygen

38. What do anoxygenic photosynthetic bacteria use instead of water as an electron donor?
o a) Carbon dioxide
o b) Hydrogen sulfide
o c) Oxygen
o d) Nitrogen

39. Which of the following is NOT an end product of the Calvin cycle?
o a) Glucose
o b) ATP
o c) G3P
o d) Organic molecules

40. The light-dependent reactions are also known as:
o a) The Calvin cycle
o b) The dark reactions
o c) The light reactions
o d) Photorespiration

41. What is the primary role of photosynthesis in the carbon cycle?
o a) Release carbon dioxide
o b) Fix carbon from the atmosphere into organic molecules
o c) Store ATP
o d) Break down glucose

42. Which of the following colors is least effective in photosynthesis?
o a) Red
o b) Blue
o c) Green
o d) Violet

43. When can the Calvin cycle proceed in plant cells, assuming ATP and NADPH are available?
o a) During the day only
o b) At night only
o c) Both day and night
o d) Only in C4 plants

44. The energy required for carbon fixation is obtained from:
o a) Water
o b) Sunlight
o c) ATP and NADPH
o d) Glucose

45. Which of the following statements is true about photorespiration?
o a) It increases plant efficiency
o b) It occurs when oxygen levels are high
o c) It enhances carbon fixation
o d) It produces more glucose

46. In photosynthesis, which compound initially captures light energy?
o a) ATP
o b) Chlorophyll
o c) NADPH
o d) RuBP

47. The products of photosynthesis are used directly in:
o a) Cellular respiration
o b) Glycolysis
o c) Fermentation
o d) The Krebs cycle

48. Which adaptation allows plants to minimize water loss?
o a) Large stomata
o b) Closing stomata during hot days
o c) Increasing transpiration
o d) Using more oxygen

49. In what part of the leaf are most chloroplasts found?
o a) Epidermis
o b) Mesophyll
o c) Guard cells
o d) Phloem

50. The process by which ATP is produced in both photosynthesis and cellular respiration is called:
o a) Fermentation
o b) Glycolysis
o c) Chemiosmosis
o d) Photolysis

51. Where is chemical energy stored in cells?
o a) Nucleus
o b) Chemical bonds
o c) Cell wall
o d) Mitochondria

52. What is the main purpose of cellular respiration?
o a) Store ATP
o b) Convert ATP to glucose
o c) Extract energy from food
o d) Create CO‚ÇÇ

53. Which of the following molecules provides the most energy per gram?
o a) Carbohydrates
o b) Lipids
o c) Proteins
o d) Nucleotides

54. What is the primary function of ATP in cells?
o a) Store genetic information
o b) Provide energy for cellular activities
o c) Transport oxygen
o d) Catalyze chemical reactions

55. How much net ATP is produced during glycolysis?
o a) 2
o b) 4
o c) 6
o d) 38

56. What is the first phase of cellular respiration?
o a) Krebs Cycle
o b) Glycolysis
o c) Electron Transport Chain
o d) Fermentation

57. Which gas is required for aerobic respiration?
o a) Nitrogen
o b) Oxygen
o c) Carbon dioxide
o d) Hydrogen

58. Where does aerobic respiration take place in eukaryotic cells?
o a) Cytoplasm
o b) Nucleus
o c) Mitochondria
o d) Golgi apparatus

59. What is the final electron acceptor in aerobic respiration?
o a) CO‚ÇÇ
o b) NADH
o c) Oxygen
o d) Glucose

60. What is the primary waste product of aerobic respiration?
o a) Oxygen
o b) Carbon dioxide
o c) Glucose
o d) Pyruvate

61. Where does glycolysis occur?
o a) Mitochondria
o b) Cytoplasm
o c) Nucleus
o d) Ribosome

62. What molecule is broken down in glycolysis?
o a) ATP
o b) Oxygen
o c) Glucose
o d) Pyruvate

63. How many molecules of pyruvate are produced from one glucose molecule?
o a) 1
o b) 2
o c) 3
o d) 4

64. What are the products of glycolysis?
o a) CO‚ÇÇ, NADH, and ATP
o b) Pyruvate, NADH, and ATP
o c) Glucose and ATP
o d) Oxygen and glucose

65. How many ATP molecules are produced in the Krebs cycle per glucose molecule?
o a) 38
o b) 2
o c) 4
o d) 34

66. What is another name for the Krebs cycle?
o a) Glycolysis
o b) Electron Transport Chain
o c) Citric Acid Cycle
o d) Calvin Cycle

67. Which cofactor(s) are required during pyruvate oxidation to form acetyl‚ÄëCoA?
o a) ATP synthase
o b) Coenzyme A and NAD‚Å∫
o c) Oxaloacetate
o d) FADH‚ÇÇ

68. Which molecule combines with acetyl‚ÄëCoA to begin the Krebs (citric acid) cycle?
o a) Pyruvate
o b) Oxaloacetate
o c) NADH
o d) ATP

69. How many NADH molecules are generated per glucose molecule in the Krebs cycle?
o a) 2
o b) 4
o c) 6
o d) 8

70. What is the main purpose of the Krebs cycle?
o a) Generate glucose
o b) Produce ATP and electron carriers
o c) Store genetic material
o d) Transport oxygen

71. Where does the electron transport chain (ETC) occur?
o a) Cytoplasm
o b) Inner mitochondrial membrane
o c) Ribosome
o d) Nucleus

72. What powers ATP synthase?
o a) NADH oxidation
o b) Proton gradient
o c) Glucose breakdown
o d) CO‚ÇÇ production

73. How many ATP molecules are generated by the ETC per glucose molecule?
o a) 4
o b) 10
o c) 34
o d) 38

74. What is the primary function of NADH and FADH‚ÇÇ in the ETC?
o a) Act as enzymes
o b) Serve as electron carriers
o c) Convert ATP to ADP
o d) Store oxygen

75. What enzyme produces ATP in oxidative phosphorylation?
o a) Pyruvate kinase
o b) ATP Synthase
o c) NADH Dehydrogenase
o d) Glucose Oxidase

76. What molecule is the final electron acceptor in the ETC?
o a) Oxygen
o b) Carbon dioxide
o c) Glucose
o d) NADH

77. What happens if oxygen is not available for the ETC?
o a) Glycolysis stops
o b) ATP production increases
o c) Fermentation occurs
o d) The Krebs cycle speeds up

78. How many ATPs are produced per NADH molecule in the ETC?
o a) 2
o b) 3
o c) 4
o d) 6

79. How many ATPs are produced per FADH‚ÇÇ molecule in the ETC?
o a) 1
o b) 2
o c) 3
o d) 4

80. What process couples the ETC to ATP synthesis?
o a) Chemiosmosis
o b) Glycolysis
o c) Fermentation
o d) Hydrolysis

81. What is the primary function of fermentation?
o a) Generate oxygen
o b) Convert glucose to pyruvate
o c) Regenerate NAD‚Å∫
o d) Produce CO‚ÇÇ

82. What is the end product of fermentation in muscle cells?
o a) Ethanol
o b) Lactic acid
o c) Acetyl-CoA
o d) Carbon dioxide

83. In yeast, fermentation produces:
o a) Lactic acid
o b) Oxygen
o c) Ethanol and CO‚ÇÇ
o d) ATP and NADH

84. How many ATP molecules are produced in fermentation?
o a) 2
o b) 10
o c) 34
o d) 38

85. What is the total net ATP yield of aerobic respiration?
o a) 2
o b) 10
o c) 32-38
o d) 40

86. What is the main reason anaerobic respiration is less efficient?
o a) It uses glucose inefficiently
o b) It requires more oxygen
o c) It produces too much ATP
o d) It uses the ETC incorrectly

87. What is a byproduct of anaerobic respiration?
o a) Water
o b) ATP
o c) Lactic acid
o d) NADH

88. What metabolic process do prokaryotes use when oxygen is absent?
o a) Aerobic respiration
o b) Fermentation
o c) Photosynthesis
o d) Oxidative phosphorylation

89. What is the total net ATP yield of aerobic respiration per glucose molecule?
o a) 2
o b) 10
o c) 32-38
o d) 40

90. What is the primary reason anaerobic respiration produces less ATP than aerobic respiration?
o a) It uses glucose inefficiently
o b) It requires more oxygen
o c) It produces too much ATP
o d) It uses the ETC incorrectly

91. What is a byproduct of anaerobic respiration in humans?
o a) Water
o b) ATP
o c) Lactic acid
o d) NADH

93. What type of phosphorylation generates the most ATP in cellular respiration?
o a) Substrate-level phosphorylation
o b) Oxidative phosphorylation
o c) Photophosphorylation
o d) Glycolysis

94. Which molecule provides the highest yield of ATP per carbon atom?
o a) Proteins
o b) Lipids
o c) Carbohydrates
o d) Nucleotides

95. Which process occurs in the mitochondria?
o a) Glycolysis
o b) Fermentation
o c) Krebs cycle
o d) Calvin cycle

96. Which of the following statements is true about oxidative phosphorylation?
o a) It does not require oxygen
o b) It occurs in the cytoplasm
o c) It produces ATP using the electron transport chain
o d) It is the first step of cellular respiration

97. How many total NADH molecules are produced from one glucose molecule during aerobic respiration?
o a) 4
o b) 6
o c) 10
o d) 12

98. What is the role of oxygen in aerobic respiration?
o a) It donates electrons to ATP synthase
o b) It acts as the final electron acceptor in the electron transport chain
o c) It breaks down glucose
o d) It activates glycolysis

99. What is metabolism?
o a) Breakdown of molecules
o b) Synthesis of molecules
o c) Combination of catabolism and anabolism
o d) Storage of energy

100. Which is NOT a source of food for cells?
o a) Plants
o b) Fungi
o c) Minerals
o d) Algae

101. Which is an example of potential energy?
o a) A rolling ball
o b) Water held behind a dam
o c) A moving car
o d) Muscle contraction

102. What type of energy is used for cellular processes?
o a) Electrical
o b) Kinetic
o c) Potential
o d) Mechanical

103. The first law of thermodynamics states that:
o a) Energy can be created and destroyed
o b) Energy is constantly increasing
o c) Energy cannot be created or destroyed
o d) Energy is always lost as heat

104. What does the second law of thermodynamics imply?
o a) Energy is completely efficient
o b) Energy transformations increase disorder
o c) Energy can be recycled infinitely
o d) No energy is ever lost

105. What is the primary energy currency of cells?
o a) Glucose
o b) ATP
o c) NADH
o d) Carbon dioxide

106. How many ATP molecules are produced per glucose molecule in aerobic respiration?
o a) 2
o b) 10
o c) 38
o d) 50

107. Which reaction releases energy?
o a) Photosynthesis
o b) ATP synthesis
o c) Cellular respiration
o d) Protein synthesis

108. Which reaction requires energy?
o a) ATP breakdown
o b) Glycolysis
o c) Photosynthesis
o d) Hydrolysis

109. What do enzymes do?
o a) Slow down reactions
o b) Increase activation energy
o c) Speed up reactions
o d) Change the reaction products

110. What is the substrate in an enzymatic reaction?
o a) The enzyme
o b) The reactant the enzyme acts on
o c) The inhibitor
o d) The final product

111. What happens if an enzyme is exposed to extreme heat?
o a) It speeds up
o b) It becomes more efficient
o c) It denatures
o d) It stops being specific

112. What type of inhibition occurs when a molecule binds to the active site of an enzyme?
o a) Non-competitive
o b) Allosteric
o c) Competitive
o d) Irreversible

113. What happens during oxidation?
o a) Gain of electrons
o b) Loss of electrons
o c) Gain of protons
o d) Loss of oxygen

114. Which molecule is reduced in cellular respiration?
o a) Oxygen
o b) Glucose
o c) ATP
o d) NADH

115. What is the main product of photosynthesis?
o a) ATP
o b) Oxygen
o c) Carbon dioxide
o d) Glucose

116. What is the final electron acceptor in aerobic respiration?
o a) Glucose
o b) NADH
o c) Oxygen
o d) ATP

117. How much energy is lost as heat in cells?
o a) 10%
o b) 40%
o c) 60%
o d) 100%

118. What is the consequence of energy loss as heat?
o a) More energy for cells
o b) Increased order
o c) Increased entropy
o d) No impact

119. Which process requires ATP?
o a) Passive diffusion
o b) Active transport
o c) Osmosis
o d) Exothermic reactions

120. Which is an example of an exergonic reaction?
o a) ATP synthesis
o b) Photosynthesis
o c) Cellular respiration
o d) Protein synthesis

121. What is the main storage form of energy in cells?
o a) Fat
o b) Glucose
o c) ATP
o d) NADH

122. Which pathway produces the most ATP?
o a) Glycolysis
o b) Krebs cycle
o c) Electron transport chain
o d) Fermentation

123. What happens in catabolism?
o a) Synthesis of molecules
o b) Breakdown of molecules
o c) Energy storage
o d) None of the above

124. Which of the following is an example of a phototroph?
o a) Humans
o b) Fungi
o c) Plants
o d) Bacteria that use sulfur compounds

125. What happens in an endergonic reaction?
o a) Energy is released
o b) Energy is stored
o c) Water is consumed
o d) ATP is broken down

126. What role does NADH play in metabolism?
o a) It provides structural support to enzymes
o b) It acts as an electron carrier
o c) It breaks down ATP
o d) It catalyzes metabolic reactions

127. What is the main function of coenzymes like FADH‚ÇÇ?
o a) Transport electrons
o b) Inhibit enzymes
o c) Store energy in ATP
o d) Provide mechanical support

128. What process produces oxygen as a byproduct?
o a) Cellular respiration
o b) Photosynthesis
o c) Fermentation
o d) Glycolysis

129. In cellular respiration, where does the majority of ATP production occur?
o a) Cytoplasm
o b) Mitochondria
o c) Ribosomes
o d) Chloroplasts

130. Which molecule is the final electron acceptor in anaerobic respiration?
o a) Oxygen
o b) Nitrogen or sulfur compounds
o c) Glucose
o d) ATP

131. What is the role of ATP synthase in the electron transport chain?
o a) Breaks down glucose
o b) Pumps protons against their gradient
o c) Produces ATP from ADP and Pi
o d) Removes carbon dioxide from the cell

132. Which of the following processes directly generates the most ATP per glucose molecule?
o a) Glycolysis
o b) Krebs cycle
o c) Oxidative phosphorylation
o d) Fermentation

133. What would happen if enzymes lost their tertiary structure?
o a) They would become more active
o b) They would lose their function
o c) They would speed up reactions
o d) They would act on any substrate

Answer Key
==========
1. b
2. c
3. b
4. c
5. b
6. a
7. b
8. a
9. b
10. b
11. b
12. c
13. b
14. d
15. b
16. b
17. b
18. c
19. b
20. c
21. b
22. a
23. a
24. b
25. a
26. b
27. c
28. b
29. b
30. b
31. b
32. a
33. b
34. a
35. c
36. c
37. b
38. b
39. b
40. c
41. b
42. c
43. c
44. c
45. b
46. b
47. a
48. b
49. b
50. c
51. b
52. c
53. b
54. b
55. a
56. b
57. b
58. c
59. c
60. b
61. b
62. c
63. b
64. b
65. b
66. c
67. b
68. b
69. c
70. b
71. b
72. b
73. c
74. b
75. b
76. a
77. c
78. b
79. b
80. a
81. c
82. b
83. c
84. a
85. c
86. a
87. c
88. b
89. c
90. a
91. c
93. b
94. b
95. c
96. c
97. c
98. b
99. c
100. c
101. b
102. b
103. c
104. b
105. b
106. c
107. c
108. c
109. c
110. b
111. c
112. c
113. b
114. a
115. d
116. c
117. c
118. c
119. b
120. c
121. c
122. c
123. b
124. c
125. b
126. b
127. a
128. b
129. b
130. b
131. c
132. c
133. b`;

      const parsed = useMemo(() => parseQuestions(RAW), [RAW]);

      const [currentIndex, setCurrentIndex] = useState(0);
      const [answers, setAnswers] = useState(() => loadSaved("answers", {}));
      const [revealed, setRevealed] = useState(() => loadSaved("revealed", {}));
      const [shuffledOrder, setShuffledOrder] = useState(() => loadSaved("order", []));
      const [shuffle, setShuffle] = useState(() => loadSaved("shuffle", true));
      // Removed autoAdvance state
      const [shuffleOptions, setShuffleOptions] = useState(() => loadSaved("shuffleOptions", false));


      // initialize order
      useEffect(() => {
        if (!shuffledOrder.length || shuffledOrder.length !== parsed.questions.length) { 
          const base = [...parsed.questions.keys()];
          const order = shuffle ? shuffleArray(base) : base;
          setShuffledOrder(order);
        }
      }, [parsed.questions.length, shuffle]); 

      // persist
      useEffect(() => save("answers", answers), [answers]);
      useEffect(() => save("revealed", revealed), [revealed]);
      useEffect(() => save("order", shuffledOrder), [shuffledOrder]);
      useEffect(() => save("shuffle", shuffle), [shuffle]);
      // Removed autoAdvance persistence
      useEffect(() => save("shuffleOptions", shuffleOptions), [shuffleOptions]);

      if (!parsed.questions.length) {
        return (
          <Wrap>
            <Header title="Interactive MCQ Quiz" subtitle="Bio: Photosynthesis ‚Ä¢ Cellular Respiration ‚Ä¢ Enzymes" />
            <Card>
              <p className="text-red-600">Could not parse any questions from the source text. Please check formatting.</p>
            </Card>
          </Wrap>
        );
      }

      const qIndex = shuffledOrder[currentIndex] ?? 0;
      const q = parsed.questions[qIndex];
      const total = parsed.questions.length; // Will be 132
      const value = answers[qIndex];
      const isCorrect = value && value === q.correct;
      const shown = !!revealed[qIndex];

      const displayedOptions = useMemo(() => {
        if (!q) return []; 
        return shuffleOptions ? shuffleArray([...q.options]) : q.options;
      }, [q, shuffleOptions]);

      const goNext = () => setCurrentIndex(i => Math.min(i + 1, total - 1));
      const goPrev = () => setCurrentIndex(i => Math.max(i - 1, 0));
      const goTo = (i) => setCurrentIndex(Math.min(Math.max(0, i), total - 1));

      const onSubmit = () => {
        if (value) {
          setRevealed(r => ({ ...r, [qIndex]: true }));
          // Removed auto-advance setTimeout
        }
      };

      const onSelect = (opt) => {
        if (shown) return; 
        setAnswers(a => ({ ...a, [qIndex]: opt }));
      };

      const summary = computeSummary(parsed.questions, answers);

      return (
        <Wrap>
          <div className="grid grid-cols-1 lg:grid-cols-[1fr_320px] gap-6 items-start">
            <Card>
              <Header
                title="Interactive MCQ Quiz"
                subtitle={`Bio: Photosynthesis ‚Ä¢ Cellular Respiration ‚Ä¢ Enzymes`}
              />
              
              <Toolbar>
                <button className="btn" onClick={() => { setShuffle(s => !s); const base = [...parsed.questions.keys()]; const order = !shuffle ? shuffleArray(base) : base; setShuffledOrder(order); setCurrentIndex(0); }}>Shuffle Qs: {shuffle ? "On" : "Off"}</button>
                <button className="btn" onClick={() => setShuffleOptions(s => !s)}>Shuffle Options: {shuffleOptions ? "On" : "Off"}</button>
                <button className="btn" onClick={() => { setAnswers({}); setRevealed({}); setCurrentIndex(0); }}>Reset</button>
                <button className="btn" onClick={() => downloadState(parsed.questions, answers)}>Download results</button>
                <span className="ml-auto text-sm opacity-75">Source: Combined_MCQs_DeDuplicated.txt</span>
              </Toolbar>

              <hr className="my-4" />

              <div className="flex items-center justify-between gap-3 mb-2">
                <span className="pill">Question {currentIndex + 1} of {total}</span> 
                <span className="pill">Answered {summary.answered}/{total}</span> 
              </div>

              <h2 className="text-xl font-semibold leading-tight mb-3">{q.prompt}</h2>

              <div role="radiogroup" aria-label={`Choices for question ${currentIndex + 1}`} className="space-y-2">
                {displayedOptions.map(opt => {
                  const id = `q${qIndex}_${opt.key}`;
                  const selected = value === opt.key;
                  const correct = q.correct === opt.key;
                  const showFeedback = shown && (selected || correct);
                  return (
                    <label key={opt.key} htmlFor={id} className={`choice ${selected ? "selected" : ""} ${showFeedback ? (correct ? "correct" : selected ? "wrong" : "") : ""}`}>
                      <input
                        type="radio"
                        id={id}
                        name={`q_${qIndex}`}
                        checked={selected || false}
                        onChange={() => onSelect(opt.key)}
                        disabled={shown}
                      />
                      <span className="key">{opt.key.toUpperCase()}</span>
                      <span>{opt.text}</span>
                    </label>
                  );
                })}
              </div>

              <div className="flex flex-wrap gap-3 mt-4">
                <button className="btn" onClick={goPrev} disabled={currentIndex === 0}>Prev</button>
                <button className="btn primary" onClick={onSubmit} disabled={!value || shown}>{shown ? "Answered" : "Check answer"}</button> 
                <button className="btn" onClick={goNext} disabled={currentIndex === total - 1}>Next</button>
                {/* Removed auto-advance checkbox label */}
              </div>

              {/* SIMPLIFIED FEEDBACK SECTION */}
              {shown && (
                <div className={`mt-4 p-3 rounded-lg ${isCorrect ? "bg-emerald-50 border border-emerald-200" : "bg-rose-50 border border-rose-200"}`}>
                  <div className="font-medium mb-1">{isCorrect ? "Correct üëç" : "Incorrect üëé"}</div>
                  {!isCorrect && (
                    <div className="text-sm mb-1">The correct answer is <span className="font-semibold">{q.correct.toUpperCase()}</span> ‚Äî {getOptionText(q, q.correct)}</div>
                  )}
                </div>
              )}
            </Card>

            <aside className="space-y-6">
              <Card>
                <h3 className="font-semibold mb-2">Progress</h3>
                <div className="grid grid-cols-6 gap-2">
                  {/* === MODIFIED PROGRESS GRID LOGIC === */}
                  {shuffledOrder.map((idx, i) => { 
                    const actualQuestion = parsed.questions[idx]; 
                    const isCurrent = i === currentIndex;
                    const isRevealed = !!revealed[idx]; // Check if this specific question index has been revealed
                    const answered = !!answers[idx];
                    const correct = answered && answers[idx] === actualQuestion?.correct;

                    // Determine color based on revealed status first
                    let colorClass = "bg-slate-200"; // Default: unanswered or answered but not revealed
                    if (isRevealed) {
                        if (correct) {
                            colorClass = "bg-emerald-200"; // Revealed and correct
                        } else if (answered) { // Only show red if revealed AND answered incorrectly
                            colorClass = "bg-rose-200"; // Revealed and wrong
                        }
                        // If revealed but not answered, stays slate-200
                    }
                    // If answered but not yet revealed, it stays slate-200

                    return (
                      <button key={idx} 
                        className={`tiny ${isCurrent ? "ring-2 ring-blue-400" : ""} ${colorClass}`}
                        title={`Q${actualQuestion?.number}`} 
                        onClick={() => goTo(i)}>
                        {i + 1} 
                      </button>
                    );
                  })}
                  {/* === END MODIFIED PROGRESS GRID LOGIC === */}
                </div>
              </Card>

              <Card>
                <h3 className="font-semibold mb-2">Summary</h3>
                <ul className="text-sm space-y-1">
                  <li>Answered: {summary.answered} / {total}</li> 
                  <li>Correct: {summary.correct}</li>
                  <li>Score: {Math.round(summary.score * 100)}%</li>
                </ul>
                <button className="btn w-full mt-3" onClick={() => window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" })}>View full review</button>
              </Card>
            </aside>
          </div>

          <Review questions={parsed.questions} answers={answers} />

          <Footer />

          <style>{styles}</style>
        </Wrap>
      );
    }

    // =================== Components ===================
    function Wrap({ children }) {
      return (
        <div className="min-h-screen bg-slate-50 text-slate-900">
          <div className="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8 space-y-6">{children}</div>
        </div>
      );
    }

    function Header({ title, subtitle }) {
      return (
        <header className="space-y-1 mb-4"> 
          <h1 className="text-2xl sm:text-3xl font-bold tracking-tight">{title}</h1>
          <p className="opacity-80">{subtitle}</p>
        </header>
      );
    }

    function Card({ children }) {
      return (
        <section className="bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6">{children}</section>
      );
    }

    function Toolbar({ children }) {
      return (
        <div className="flex items-center gap-3 flex-wrap">{children}</div>
      );
    }

    // SIMPLIFIED Review component
    function Review({ questions, answers }) {
      const misses = questions.map((q, idx) => ({ q, idx })).filter(({ q, idx }) => answers[idx] && answers[idx] !== q.correct);
      if (!questions?.length) return null;
      return (
        <Card>
          <h3 className="text-lg font-semibold mb-3">End Review</h3>
          <p className="text-sm opacity-80 mb-4">Missed questions are listed first with correct answers.</p>

          {misses.length === 0 ? (
            <p className="text-emerald-700">No misses ‚Äî great work.</p>
          ) : null}

          <ol className="space-y-4 list-decimal list-inside">
            {misses.map(({ q, idx }) => (
              <li key={idx}>
                <div className="font-medium">Q{q.number}. {q.prompt}</div>
                <div className="pl-5 text-sm">
                  <div className="mb-1">Your answer: <span className="font-semibold">{answers[idx]?.toUpperCase()}</span> ‚Äî {getOptionText(q, answers[idx])}</div>
                  <div className="mb-1">Correct: <span className="font-semibold">{q.correct.toUpperCase()}</span> ‚Äî {getOptionText(q, q.correct)}</div>
                </div>
              </li>
            ))}
          </ol>

          <hr className="my-4" />
          <details>
            <summary className="cursor-pointer select-none">Show all questions and answers</summary>
            <ol className="mt-3 space-y-4 list-decimal list-inside">
              {questions.map((q, idx) => (
                <li key={idx}>
                  <div className="font-medium">Q{q.number}. {q.prompt}</div>
                  <ul className="pl-5 text-sm list-disc">
                    {q.options.map(o => (
                      <li key={o.key} className={o.key === q.correct ? "font-semibold" : ""}>
                        {o.key.toUpperCase()}) {o.text}
                      </li>
                    ))}
                  </ul>
                  <div className="pl-5 text-sm opacity-80">Answer: {q.correct.toUpperCase()}</div>
                </li>
              ))}
            </ol>
          </details>
        </Card>
      );
    }

    function Footer() {
      return (
        <footer className="text-xs opacity-70 text-center py-6">
          Built for spaced practice and rapid review. Use ‚¨ÜÔ∏é‚¨áÔ∏é to navigate answers, ‚Üê ‚Üí to switch questions, and Enter to check.
        </footer>
      );
    }

    // =================== Parser & Helpers ===================
    
    // Parser with manually cleaned data
    function parseQuestions(raw) {
      // 1. Normalize newlines, spaces
      const cleanRaw = raw
        .replace(/\r\n/g, "\n")
        .replace(/\r/g, "\n")
        .replace(/[\u00A0\u200B\u202F\uFEFF]/g, " ");

      // 2. Split answer key
      const parts = cleanRaw.split(/\s*\n\s*Answer Key\s*\n\s*=+\s*\n\s*/);
      const body = parts[0] || "";
      const keyText = parts[1] || "";

      const key = new Map();
      keyText.split(/\n+/).forEach(line => { 
        const m = line.trim().match(/^(\d+)\.\s*([a-d])/i);
        if (m) key.set(Number(m[1]), m[2].toLowerCase());
      });

      // 3. Break into question blocks
      const blocks = body.split(/\n\s*(?=\d+\.)/).map(s => s.trim()).filter(Boolean);

      const questions = [];
      for (const block of blocks) {
        const first = block.match(/^(\d+)\.\s*(.*)$/s); 
        if (!first) continue;
        
        const qNum = Number(first[1]);
        let rest = first[2].trim();
        const options = [];
        let prompt;
        let optionLines;

        // Split into lines
        const lines = rest.split(/\n+/).map(l => l.trim()).filter(Boolean);
        if (lines.length === 0) continue;
        prompt = lines[0];
        optionLines = lines.slice(1);

        // Check if first line *also* contains option 'a' (for Q99-123)
        const sameLineMatch = prompt.match(/^(.*?)\s+([aA])\)\s*(.*)$/);
        if (sameLineMatch && qNum >= 99 && qNum <= 123) {
           prompt = sameLineMatch[1].trim();
           const text = sameLineMatch[3].trim();
           if (text) options.push({ key: 'a', text });
        }


        for (const line of optionLines) {
          const trimmedLine = line.trim();
          
          // Skip placeholder artifact lines
          if (/^d\)\s*Option\s*D$/i.test(trimmedLine)) continue;

          // Simple regex: Find letter (a-d), parenthesis, then text, allowing 'o ' prefix
          const m = trimmedLine.match(/^\s*(?:o\s+)?([a-dA-D])\s*\)\s*(.*)$/);
          
          if (m) {
            const key = m[1].toLowerCase();
            const text = m[2].trim();
            
            // Add if text is valid and key not already added
            if (text && !options.some(o => o.key === key)) {
              options.push({ key, text });
            }
          }
        }

        // Add question if prompt exists and has >= 2 options
        if (prompt && options.length >= 2) { 
          questions.push({ number: qNum, prompt, options, correct: key.get(qNum) || "a" });
        }
      }

      questions.sort((a, b) => a.number - b.number);
      return { questions }; // Should contain 132 questions
    }

    // Fisher-Yates shuffle algorithm
    function shuffleArray(arr) {
      const a = [...arr]; // Create a copy
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]]; // Swap elements
      }
      return a;
    }

    function save(k, v) {
      try { localStorage.setItem("quiz_" + k, JSON.stringify(v)); } catch {}
    }
    function loadSaved(k, fallback) {
      try { const s = localStorage.getItem("quiz_" + k); return s ? JSON.parse(s) : fallback; } catch { return fallback; }
    }

    function getOptionText(q, key) {
      const o = q?.options?.find(o => o.key === key);
      return o?.text || "";
    }

    function computeSummary(questions, answers) {
      let answered = 0, correct = 0;
      questions.forEach((q, idx) => {
        const a = answers[idx]; 
        if (a) {
          answered++;
          if (a === q.correct) correct++;
        }
      });
      return { answered, correct, score: questions.length ? correct / questions.length : 0 };
    }

    // SIMPLIFIED downloadState
    function downloadState(questions, answers) {
      const misses = [];
      questions.forEach((q, idx) => {
        if (answers[idx] && answers[idx] !== q.correct) misses.push(idx);
      });
      const lines = [];
      const score = Math.round((questions.length ? Object.values(answers).filter((v, i) => answers[i] === questions[i]?.correct).length / questions.length : 0) * 100);
      lines.push(`Score: ${score}%`);
      lines.push("");
      lines.push("Missed Questions:");
      misses.forEach(idx => {
        const q = questions[idx];
        lines.push(`Q${q.number}. ${q.prompt}`); 
        lines.push(`Your answer: ${(answers[idx] || "").toUpperCase()} ‚Äî ${getOptionText(q, answers[idx])}`);
        lines.push(`Correct: ${q.correct.toUpperCase()} ‚Äî ${getOptionText(q, q.correct)}`);
        lines.push("");
      });
      const blob = new Blob([lines.join("\n")], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "quiz_results.txt"; a.click();
      setTimeout(() => URL.revokeObjectURL(url), 1000);
    }

    // =================== Styles ===================
    const styles = `
    :root { --txt: #0f172a; --muted:#64748b; --brand:#2563eb; }
    * { box-sizing: border-box; }
    body { margin: 0; }
    
    .btn { 
      appearance:none; 
      border:1px solid #d1d5db; /* slate-300 */
      background:#f3f4f6; /* slate-100 */
      padding:.5rem .8rem; 
      border-radius:.75rem; 
      font-weight:600; 
      cursor:pointer; 
      transition: background-color 0.2s, border-color 0.2s;
    }
    .btn:hover { 
      border-color:#9ca3af; /* slate-400 */
      background:#e5e7eb; /* slate-200 */
    }
    .btn:disabled { opacity:.5; cursor:not-allowed; }
    .btn.primary { 
      background:#2563eb; /* blue-600 */
      color:white; 
      border-color:#1d4ed8; /* blue-700 */
    }
    .btn.primary:hover:not(:disabled) { 
      background:#1d4ed8; /* blue-700 */
      border-color:#1e40af; /* blue-800 */
    }

    .choice { display:flex; gap:.6rem; align-items:flex-start; border:1px solid #e2e8f0; padding:.6rem .75rem; border-radius:.75rem; cursor:pointer; }
    .choice input:disabled { cursor: not-allowed; } 
    .choice input:disabled + .key + span { opacity: 0.7; } 
    .choice .key { display:inline-block; min-width:1.5rem; text-align:center; font-weight:700; opacity:.7; }
    .choice.selected { border-color:#94a3b8; background:#f8fafc; }
    .choice.correct { border-color:#34d399; background:#ecfdf5; }
    .choice.wrong { border-color:#fca5a5; background:#fff1f2; }
    .pill { font-size:.8rem; padding:.15rem .5rem; background:#f1f5f9; border:1px solid #e2e8f0; border-radius:999px; }
    .tiny { width:2rem; height:2rem; border-radius:.5rem; border:1px solid #cbd5e1; font-weight:700; }
    `;


    // 5. Find the root element and render the App
    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<App />);

  </script>
</body>
</html>
